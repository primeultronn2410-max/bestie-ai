<!DOCTYPE html>
<html>
<head>
  <title>Bestie AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="
  background:black;
  color:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:sans-serif;
  text-align:center;
">

  <div id="status" style="margin-bottom:16px;font-size:18px;">
    Tap anywhere
  </div>

  <div id="userText" style="margin-top:10px;color:#00ffcc;"></div>
  <div id="aiText" style="margin-top:10px;color:#ff66cc;"></div>

<script>
let started = false;
let recognition;

// Setup Speech Recognition FIRST
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

recognition = new SpeechRecognition();
recognition.lang = "hi-IN";
recognition.continuous = false;

// When user finishes speaking
recognition.onresult = async (event) => {
  const text = event.results[0][0].transcript;

  document.getElementById("userText").innerText = "You: " + text;
  document.getElementById("status").innerText = "Thinkingâ€¦";

  const res = await fetch(
    "https://bestie-ai-worker.primeultronn2410.workers.dev",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    }
  );

  const data = await res.json();
  document.getElementById("aiText").innerText = "Her: " + data.reply;
};

// Start only on user tap
document.body.addEventListener("click", () => {
  if (started) return;
  started = true;

  const msg = new SpeechSynthesisUtterance(
    "Heyâ€¦ aap aa gaye. Bataiye, aaj mood kaisa hai?"
  );

  msg.lang = "hi-IN";
  msg.rate = 0.95;
  msg.pitch = 1.1;

  // IMPORTANT: mic starts AFTER she finishes speaking
  msg.onend = () => {
    recognition.start();
    document.getElementById("status").innerText = "Listeningâ€¦";
  };

  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(msg);
});
</script>

</body>
</html>};

window.speechSynthesis.cancel();
window.speechSynthesis.speak(msg);

      // Speech Recognition
      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;

      recognition = new SpeechRecognition();
      recognition.lang = "hi-IN";
      recognition.continuous = false;

      recognition.onresult = async (event) => {
  const text = event.results[event.results.length - 1][0].transcript;
alert("Heard: " + text); // ðŸ” DEBUG
  document.getElementById("userText").innerText = "You: " + text;

  const res = await fetch(
    "https://bestie-ai-worker.primeultronn2410.workers.dev",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    }
  );

  const data = await res.json();
  document.getElementById("aiText").innerText = "Her: " + data.reply;
};

msg.onend = () => {
  recognition.start();
  document.getElementById("status").innerText = "Listening...";
};
  </script>

</body>
</html>
